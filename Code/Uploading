#!/bin/bash

#we get the name of the folder to save the files

folder=$1

#filename1=logs_upload

#log purposes
#date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"
#echo -e "The uploading of the file has started\n" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"

#Script that uploads a file of interest and then saves its ID in a file to be deleted


#The file where the logs will be saved

x=$(date)
filename=logs_upload #_$x




while true; do

#log purposes
date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
echo -e "Uploading again (or at the start) \n" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"

#log terminal purposes
echo -e "Uploading again (or at the start) \n"



#We execute the upload and safe the output in the variable
IDstatement=$(sudo /home/upboard/Desktop/UpBoard-Code-and-Results/Code/gdrive-master/gdrive-master --config /home/upboard/Desktop/UpBoard-Code-and-Results/Code/gdrive-master upload /home/upboard/Desktop/r2_l_TDC1.mat)


line_1_IDstatement=$(echo -e "$IDstatement" | sed -n '2p')

#log terminal purposes
echo $line_1_IDstatement



n_Upload=$(sudo cat /home/upboard/Desktop/UpBoard-Code-and-Results/Code/n_Upload)
addition=1
n_Upload=$(( $n_Upload + $addition ))

sudo echo "$n_Upload" > /home/upboard/Desktop/UpBoard-Code-and-Results/Code/n_Upload


if [ "$line_1_IDstatement" != "Failed to upload file: googleapi: Error 403: Rate Limit Exceeded, rateLimitExceeded" ];then


	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	echo -e "Finish Uploading. The IDStatement is $IDstatement .\n" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"




	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	echo "Successfully uploaded file with ID $IDstatement" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"


	#log purposes in terminal
	sudo /home/upboard/Desktop/UpBoard-Code-and-Results/Code/gdrive-master/gdrive-master --config /home/upboard/Desktop/UpBoard-Code-and-Results/Code/gdrive-master list #to show on the list that is has been Uploaded 

	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	echo "The list of files in drive after uploading is" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	sudo /home/upboard/Desktop/UpBoard-Code-and-Results/Code/gdrive-master/gdrive-master --config /home/upboard/Desktop/UpBoard-Code-and-Results/Code/gdrive-master list  >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"


	echo "$IDstatement" > /home/upboard/Desktop/UpBoard-Code-and-Results/Code/IDGoogleDrive
	sudo chmod 777 /home/upboard/Desktop/UpBoard-Code-and-Results/Code/IDGoogleDrive
else

	#log terminal purposes
	echo -e "Error 403, trying again"

	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	echo "Error 403, trying again" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"

fi



done

