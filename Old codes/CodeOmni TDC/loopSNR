#!/bin/bash


#we the input with the name of the folder


folder=$1


filename1=logs_general


#log purposes
date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"
echo "The collection of SNR info has started" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"


#This script is in charge of extracting the SNR of the BS. It is saved in the file "SNRInfo_time" where "time" is the date when the script was executed. 


#sleep 40


#We give a name to the file
x=$(date)

nameFile=SNRInfo_$x



#To initialize the file
echo "" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$nameFile"
sudo chmod 777 /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$nameFile"



#While loop to save the SNR as fast as possible.

while true; do


######################################## IN CASE THE MODEM IS CONNECTED, OTHERWISE WE DONT READ AND WE DONT SAVE   ######################################################


#modem_number_line=$(sudo mmcli -L | sed -n '2p')

#if [ "$modem_number_line" != "No modems were found" ]; then

#	modem_number=$(sudo mmcli -L | sed -n '3p' | awk -F"/Modem/" '{print $2}' | awk -F"[Sierra]" '{print $1}' | awk -F"[" '{print $1}')
#	state_modem=$(sudo mmcli -m $modem_number | sed -n '21p' | awk -F"'" '{print $2}' )
#
#	if [ "$state_modem" == "connected" ]; then


		#Format stuff
		echo " " >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$nameFile" #blank space



		#Acquiring the SNR and other parameters of the BS

		date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$nameFile"
		SNR=$(sudo qmicli -d /dev/cdc-wdm1 -p --device-open-mbim --nas-get-signal-strength)
		echo "$SNR" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$nameFile"



		echo " " >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$nameFile" #blank space

#	else

		#log purposes
#		date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"
#		echo -e "MODEM WITH STATE DIFFERENT FROM .CONNECTED,. LOG MESSAGE FROM LOOPSNR \n" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"

	
#	fi

#else


	#log purposes
#	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"
#	echo -e "MODEM NOT FOUND IN THE UPBOARD. LOG MESSAGE FROM LOOPSNR \n" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"
#fi


done
