#!/bin/bash

#we get the name of the folder to save the files

folder=$1

filename=logs_upload

while true; do

#log purposes
date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
sudo chmod 777 /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
echo -e "Uploading again (or at the start) \n" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
#log terminal purposes
echo -e "Uploading again (or at the start) \n"

#We execute the upload and safe the output in the variable
IDstatement=$(sudo /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master/gdrive-master --config /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master upload /home/upboard/Desktop/r2_l_TDC1.mat)
line_1_IDstatement=$(echo -e "$IDstatement" | sed -n '2p')

#log terminal purposes
echo $line_1_IDstatement

if [ "$line_1_IDstatement" != "Failed to upload file: googleapi: Error 403: Rate Limit Exceeded, rateLimitExceeded" ];then

	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	echo -e "Finish Uploading. The IDStatement is $IDstatement .\n" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	echo "Successfully uploaded file with ID $IDstatement" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	#log purposes in terminal
	sudo /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master/gdrive-master --config /home/upboard/Desktop/UpBoard-Code-and-Results/Code/Omnigdrive-master list #to show on the list that is has been Uploaded 
	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	echo "The list of files in drive after uploading is" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	sudo /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master/gdrive-master --config /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master list  >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	echo "$IDstatement" > /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/IDGoogleDrive
	sudo chmod 777 /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/IDGoogleDrive
else
	#log terminal purposes
	echo -e "Error 403, trying again"
	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
	echo "Error 403, trying again" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename"
fi

done

