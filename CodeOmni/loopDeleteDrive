#!/bin/bash

#Thread that checks if a file was uploaded to google drive and delete it if such

folder=$1
filename1=logs_upload

while true; do

# Remove the trash content
sudo rm -rf /home/upboard/.local/share/Trash/files

if [ -f /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/IDGoogleDrive ]; then
	IDsentence=$(cat /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/IDGoogleDrive | awk -F"Uploaded " '{print $2}')
	ID=$(echo "$IDsentence" | awk -F" at" '{print $1}')	
	sleep 1
	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"
	echo "the readed ID to delete is:  $ID$state" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"
	echo -e "Deleting...\n" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1" 

	#Deleting + log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"
	sudo /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master/gdrive-master --config /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master delete $ID >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1" #we delete the new file

	#log purposes
	date --iso-8601=ns >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"	
	echo -e "The list of files after deleting is: \n" >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"
	sudo /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master/gdrive-master --config /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master list >> /home/upboard/Desktop/UpBoard-Code-and-Results/Results/"$folder"/"$filename1"

	#log purposes on the terminal
	sudo /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master/gdrive-master --config /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/gdrive-master list #to check is empty again
	
	sudo rm /home/upboard/Desktop/UpBoard-Code-and-Results/CodeOmni/IDGoogleDrive #we remove the file with the old ID
fi
done
